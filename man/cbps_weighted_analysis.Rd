% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cbps_weighted_anaylsis.R
\name{cbps_weighted_analysis}
\alias{cbps_weighted_analysis}
\title{CBPS Propensity Score Weighted GLM Analysis}
\usage{
cbps_weighted_analysis(
  data,
  outcome_var,
  treatment_var,
  additional_predictors = NULL,
  imputation_vars = NULL,
  imputation_predictors = NULL,
  propensity_covariates = NULL,
  mice_m = 5,
  mice_method = "pmm",
  mice_seed = 500,
  cbps_estimand = "ATE",
  cbps_stop_method = "es.mean",
  bootstrap_n = 1000,
  bootstrap_seed = 20250417,
  balance_threshold_m = 0.1,
  balance_threshold_v = 2,
  verbose = TRUE
)
}
\arguments{
\item{data}{A data frame containing the analysis variables}

\item{outcome_var}{Character. Name of the outcome variable (y-variable)}

\item{treatment_var}{Character. Name of the treatment variable (x-variable)}

\item{additional_predictors}{Character vector. Additional fixed effects/random effects to include in the outcome model}

\item{imputation_vars}{Character vector. Variables to impute missing values for}

\item{imputation_predictors}{Character vector. Variables to help with imputation but not used in final model}

\item{propensity_covariates}{Character vector. Variables to include in propensity weighting (in addition to imputed vars)}

\item{mice_m}{Integer. Number of multiple imputations (default: 5)}

\item{mice_method}{Character. MICE imputation method (default: "pmm" for Predictive Mean Matching)}

\item{mice_seed}{Integer. Random seed for MICE imputation (default: 500)}

\item{cbps_estimand}{Character. CBPS estimand: "ATE" (Average Treatment Effect) or "ATT" (Average Treatment on Treated) (default: "ATE")}

\item{cbps_stop_method}{Character. Balance criteria for tuning (default: "es.mean")}

\item{bootstrap_n}{Integer. Number of bootstrap samples (default: 1000)}

\item{bootstrap_seed}{Integer. Random seed for bootstrap (default: 20250417)}

\item{balance_threshold_m}{Numeric. Balance threshold for mean differences (default: 0.1)}

\item{balance_threshold_v}{Numeric. Balance threshold for variance ratios (default: 2)}

\item{verbose}{Logical. Whether to print progress messages (default: TRUE)}
}
\value{
A list containing:
\itemize{
\item \code{data}: Final analysis dataset with weights
\item \code{model}: Fitted weighted GLM model
\item \code{weights}: CBPS weight object from WeightIt
\item \code{balance}: Balance assessment from cobalt
\item \code{bootstrap_summary}: Bootstrap confidence intervals
\item \code{bootstrap_results}: Full bootstrap results matrix
\item \code{sample_sizes}: List with initial and final sample sizes
}
}
\description{
Performs comprehensive Covariate Balancing Propensity Score (CBPS) weighted analysis
with multiple imputation, balance assessment, and bootstrap confidence intervals.
}
\details{
This function implements a comprehensive workflow for CBPS analysis including:
\enumerate{
\item Data cleaning and missing data assessment
\item Multiple imputation using MICE with MCAR testing
\item CBPS propensity score estimation
\item Covariate balance assessment
\item Weighted GLM fitting
\item Bootstrap confidence intervals
}

The function tests for Missing Completely At Random (MCAR) assumptions and provides
warnings about potential Missing At Random (MAR) or Missing Not At Random (MNAR) scenarios.
}
\examples{
\dontrun{
# Basic usage
results <- cbps_weighted_analysis(
  data = my_data,
  outcome_var = "weight_percentile",
  treatment_var = "treatment_group",
  additional_predictors = c("age", "gender"),
  imputation_vars = c("mother_age", "gestational_age"),
  verbose = TRUE
)

# Access results
summary(results$model)
results$bootstrap_summary
results$balance
}

}
\references{
Allison, P. (2015). Imputation by predictive mean matching: Promise & peril. Statistical Horizons.

Austin, P. C. (2009). Balance diagnostics for comparing the distribution of baseline
covariates between treatment groups in propensity-score matched samples. Statistics in Medicine, 28(25), 3083-107.

Li, Y., & Li, L. (2021). Propensity score analysis methods with balancing constraints:
A Monte Carlo study. Statistical Methods in Medical Research, 30(4), 1119-1142.
}
