% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/npcbps_weighted_analysis.R
\name{npcbps_weighted_analysis_mi}
\alias{npcbps_weighted_analysis_mi}
\title{Nonparametric CBPS Propensity Score Weighted GLM Analysis with Proper Multiple Imputation}
\usage{
npcbps_weighted_analysis_mi(
  data,
  outcome_var,
  treatment_var,
  additional_predictors = NULL,
  imputation_vars = NULL,
  imputation_predictors = NULL,
  propensity_covariates = NULL,
  mice_m = 5,
  mice_method = "pmm",
  mice_seed = 500,
  cbps_estimand = "ATE",
  balance_threshold_m = 0.1,
  balance_threshold_v = 2,
  family = gaussian(),
  verbose = TRUE
)
}
\arguments{
\item{data}{A data frame containing the analysis variables}

\item{outcome_var}{Character. Name of the outcome variable (y-variable)}

\item{treatment_var}{Character. Name of the treatment variable (x-variable)}

\item{additional_predictors}{Character vector. Additional fixed effects/random effects to include in the outcome model}

\item{imputation_vars}{Character vector. Variables to impute missing values for}

\item{imputation_predictors}{Character vector. Variables to help with imputation but not used in final model}

\item{propensity_covariates}{Character vector. Variables to include in propensity weighting (in addition to imputed vars)}

\item{mice_m}{Integer. Number of multiple imputations (default: 5)}

\item{mice_method}{Character. MICE imputation method (default: "pmm" for Predictive Mean Matching)}

\item{mice_seed}{Integer. Random seed for MICE imputation (default: 500)}

\item{cbps_estimand}{Character. CBPS estimand: "ATE" (Average Treatment Effect) or "ATT" (Average Treatment on Treated) (default: "ATE")}

\item{balance_threshold_m}{Numeric. Balance threshold for mean differences (default: 0.1)}

\item{balance_threshold_v}{Numeric. Balance threshold for variance ratios (default: 2)}

\item{family}{A family object specifying the error distribution and link function for GLM (default: gaussian())}

\item{verbose}{Logical. Whether to print progress messages (default: TRUE)}
}
\value{
A list containing:
\itemize{
\item \code{pooled_results}: Pooled coefficients using Rubin's rules
\item \code{imputation_results}: List of results from each imputation
\item \code{balance_summary}: Summary of balance across imputations
\item \code{sample_sizes}: List with initial and final sample sizes
}
}
\description{
Performs comprehensive Nonparametric Covariate Balancing Propensity Score (NPCBPS) weighted analysis
with proper multiple imputation using Rubin's rules for pooling.
}
\details{
This function implements the correct multiple imputation workflow:
\enumerate{
\item Data cleaning and missing data assessment
\item Multiple imputation using MICE with MCAR testing
\item For EACH imputation:
\itemize{
\item Estimate Nonparametric CBPS propensity scores
\item Assess covariate balance
\item Fit weighted GLM
}
\item Pool results across imputations using Rubin's rules
}

Rubin's rules combine:
\itemize{
\item Within-imputation variance (average variance across imputations)
\item Between-imputation variance (variance of estimates across imputations)
\item Simulation variance due to finite number of imputations
}
}
\references{
Rubin, D. B. (1987). Multiple Imputation for Nonresponse in Surveys. Wiley.

van Buuren, S. (2018). Flexible Imputation of Missing Data (2nd ed.). CRC Press.
}
